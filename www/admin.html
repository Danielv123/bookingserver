<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Booking admin page</title>
    <script language="JavaScript" type="text/javascript" src="jquery-3.3.1.min.js"></script>
</head>
<body>
    <ul id="userList">
        
    </ul>
    <script>
        var userList = document.querySelector("#userList")
        $.get("/api/users", function (users) {
            console.log(users)
            for (var i = 0; i < users.length; i++) {
                var user = users[i];
                userList.innerHTML += '<li><p id="name" style="display:none;">'+user.name+'</p><input class="displayName" style="width:300px;display: inline-block;" value="' + user.displayName + '"></input>'+
                '<input style = "width:100px;" placeholder = "new PIN" ></input >'+
                '<input class="updateInformation" type="button" value="Update information"></input></li>'
            }
            var updateInformationButtons = document.querySelectorAll(".updateInformation")
            for (var o = 0; o < updateInformationButtons.length; o++) {
                var button = updateInformationButtons[o];
                button.onclick = function (e) {
                    var button = e.srcElement;
                    var data = {
                        PIN: Number(localStorage.PIN),
                        name: button.parentElement.children[0].innerHTML,
                        newDisplayName: button.parentElement.children[1].value,
                        newPin: button.parentElement.children[2].value,
                    };
                    var settings = {
                        "url": "/api/editUser",
                        "method": "POST",
                        "timeout": 0,
                        "headers": {
                            "Content-Type": "application/json"
                        },
                        "data": JSON.stringify(data),
                    };
                    $.ajax(settings).done(function (response) {
                        console.log(response);
                    });
                }
            }
        });
    </script>
</body>
</html>